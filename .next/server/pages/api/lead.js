"use strict";(()=>{var e={};e.id=453,e.ids=[453],e.modules={576:(e,t,r)=>{r.a(e,async(e,n)=>{try{r.r(t),r.d(t,{config:()=>d,default:()=>c,routeModule:()=>l});var a=r(3480),o=r(8667),s=r(6435),i=r(9606),u=e([i]);i=(u.then?(await u)():u)[0];let c=(0,s.M)(i,"default"),d=(0,s.M)(i,"config"),l=new a.PagesAPIRouteModule({definition:{kind:o.A.PAGES_API,page:"/api/lead",pathname:"/api/lead",bundlePath:"",filename:""},userland:i});n()}catch(e){n(e)}})},2971:e=>{e.exports=import("zod")},3480:(e,t,r)=>{e.exports=r(5600)},3939:e=>{e.exports=require("@supabase/supabase-js")},5600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6435:(e,t)=>{Object.defineProperty(t,"M",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},7706:e=>{e.exports=import("@sentry/node")},8667:(e,t)=>{Object.defineProperty(t,"A",{enumerable:!0,get:function(){return r}});var r=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})},9606:(e,t,r)=>{r.a(e,async(e,n)=>{try{r.r(t),r.d(t,{default:()=>c});var a=r(2971),o=r(3939),s=r(7706),i=e([a,s]);[a,s]=i.then?(await i)():i,s.init({dsn:process.env.SENTRY_DSN||"",tracesSampleRate:1});let d=a.z.object({nome:a.z.string().min(2),telefone:a.z.string().min(8),email:a.z.string().email(),interesse:a.z.enum(["seguro-de-vida","seguro-viagem","plano-odontologico"])}),l=process.env.SUPABASE_URL,p=process.env.SUPABASE_SERVICE_ROLE_KEY,f=(0,o.createClient)(l,p),A=new Map;function u(e){return e.replace(/[<>"'\\]/g,"")}async function c(e,t){if("POST"!==e.method)return t.status(405).json({error:"M\xe9todo n\xe3o permitido"});let r=e.body.recaptchaToken;if(!r)return t.status(400).json({error:"reCAPTCHA n\xe3o enviado"});try{let e=await fetch(`https://www.google.com/recaptcha/api/siteverify?secret=${process.env.RECAPTCHA_SECRET_KEY}&response=${r}`,{method:"POST"}),n=await e.json();if(!n.success||n.score<.5)return t.status(400).json({error:"Falha na verifica\xe7\xe3o do reCAPTCHA"})}catch(e){return t.status(500).json({error:"Erro ao verificar reCAPTCHA"})}let n=e.headers["x-forwarded-for"]?.toString()||e.socket.remoteAddress||"",a=Date.now(),o=A.get(n)||{count:0,last:a};if(a-o.last>6e4&&(o.count=0,o.last=a),o.count++,A.set(n,o),o.count>5)return t.status(429).json({error:"Muitas requisi\xe7\xf5es, tente novamente mais tarde."});let i=d.safeParse(e.body);if(!i.success)return t.status(400).json({error:"Dados inv\xe1lidos",details:i.error.errors});let{nome:c,telefone:l,email:p,interesse:P}=i.data,m=u(c),E=u(l),g=u(p),v=u(P);try{let{error:e}=await f.from("leads").insert([{nome:m,telefone:E,email:g,interesse:v,data:new Date().toISOString()}]);if(e)throw e;return t.status(200).json({ok:!0})}catch(e){return s.captureException(e),t.status(500).json({error:"Erro ao salvar lead",details:e.message})}}n()}catch(e){n(e)}})}};var t=require("../../webpack-api-runtime.js");t.C(e);var r=t(t.s=576);module.exports=r})();